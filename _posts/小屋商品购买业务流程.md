# 商品详情查询流程

获取商品图片

获取商品，型号 价格

获取用户地址

获取组合套餐信息

适配车型信息

供应商信息

店铺推荐列表 猜你喜欢列表

商品评论

实时购买，滚动数据

# 确认订单流程

用户过审检查

查询用户地址填充

购买商品区域禁售查询，过滤

合并相同型号商品，计算型号价格，购买规则填充，库存填充，商品，库存状态检查

商品按照供应商拆单，加载优惠券（店铺，平台）列表，计算跨店满减金额，计算税费，汇总订单价格参数，计算红包金额，

 

 
# 生成订单流程
 
## 借助WebAsyncTask建立异步任务

### 验证

**根据token获取用户信息**

**验证用户是否初审通过**

**是否使用红包，可用红包余额验证**

**查询是否有商品处于活动中**

- 通过sku集合，商品库存计算器 查询商品库存信息
	- 初始化商品型号：根据商品型号查询商品型号信息
		- SKU基准价
		- 型号信息
	- 判断商品是否处于活动中
		- 单品，预售，赠品，满减，砍价
	- 判断商品是否处于禁售区域
	- 禁售商品库存置为0
	- 排除商品在活动中，但是商品下存在型号不处于活动中的型号
	- 活动商品库存计算，多个活动按照优先级获取活动库存
	- 获取对应活动商品库存
	- 计算普通商品库存
	- redis扣减库存
	- 成功则发送创建订单消息，轮询订单生成结果
	
**普通商品创建订单**