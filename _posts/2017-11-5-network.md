---
layout: post
title: '计算机网络之协议森林'
subtitle: 'web开发常见的计算机网络协议'
date: 2017-11-05
categories: 计算机网络
author: yates
cover: 'http://cctv.com'
tags: 计算机网络
---

### 协议模型
**OSI七层协议模型**

OSI七层协议模型分为应用层，表示层，会话层，传输层，网络层，数据链路层，物理层

**TCP/IP模型**
TCP/IP模型分为应用层，传输层，网络层，数据链路层

**TCP/IP模型和OSI七层协议模型对应关系**

![此处输入图片的描述](http://yatesblog.oss-cn-shenzhen.aliyuncs.com/img/2017-11-05-network/1.png)


## 数据如何传输
根据TCP/IP协议栈的定义，数据产生后通过应用层，传输层，网络层，链路层依次对其做处理，封装数据，对其加对应的首部，最终转换为0和1的电信号，通过物理设备进行传输，接受端再进行一层一层的解包，最终拿到请求的数据。

### 链路层
直接的0和1电信号是没有意义的，所以要对**电信号分组**，以太网规定**一组电信号**就是**一个数据包**，用**帧**表示，

数据包的结构

- **首部**:包含目标**MAC地址**（固定14字节,MAC地址是具有网卡的物理机唯一身份标识；）和**类型**。
- **数据**：数据最短46字节，最长1500字节，所以如果数据过长，则要进行**分帧传输**
- **尾部**

数据链路层的工作就是，对电信号进行分组传输，然后当数据到达子网后，以太网通过**广播**的形式，发送数据给所有主机，主机通过匹配数据首部的**MAC地址**,得到数据。**以太网和WiFi是链路层的两种协议**。

### 网络层
在网络层里，有三个很重要的协议，IP协议，ARP协议，路由协议

**IP协议**
网络层通过应用层传入的ip来进行主机的寻址，ip地址分为IPV4和IPV6，IPV4**前面部分代表网络地址**，**后面部分代表**局域网中地址**，如果两个IP地址在同一个子网内，网络地址一定相同。

**ARP协议**
**地址解析协议**，根据IP地址获取MAC地址。首先ARP**请求目标主机IP地址**，到达数据链路层后，**子网内主机**通过链路层发送的数据包内的IP地址进行**匹配**，匹配到后就像ARP返回自己MAC地址，以此确定目标机MAC地址，并缓存IP和MAC的映射关系，下次请求节约寻址时间。arp -a查询本机缓存的映射

**路由协议**
由于ARP协议MAC寻址在同一个子网中，网络层首先通过IP协议判断两个主机是否同一个子网，如在同一个子网，则ARP寻址，广播数据包到子网主机；如不在同一个子网，以太网将数据包发送到**网关进行路由**，最终到达目标IP子网，再通过ARP寻址。**路由器**(router)实际上就是一台配备有**多个网卡的专用电脑**。每一台主机和路由都能了解局域网内的IP地址和MAC地址的对应关系，这是实现IP包封装(encapsulation)到帧的基本条件
 
**IP数据包**

网络层包装的数据包叫IP数据包
**首部**:首部包含**目标IP地址**和**源IP地址**，
**数据**:数据包最大长度1500个字符，超过就要分包，数据过短，传输效率的降低.
 
网络层主要工作定义网络地址，区分网段，对于不同子网数据进行路由，子网内MAC寻址，
 
### 传输层

**作用**

**定义端口，标识应用程序，实现端到端**的通信

**UDP协议**

群发数据到主机所有应用中，UDP协议是没有确认机制的

**构成**：

- **首部**：8个字节，**包括源端口和目标端口**
- **数据**：
 
**TCP协议**

面向连接，**可靠**，基于**字节流**的通信协议。通过建立三次握手，四次挥手的**确认机制**来保证数据的安全，可靠性。TCP数据包是**没有长度限制**的，但是一般情况下是不会超过IP数据包的长度。

- 三次握手 
	- 请求方发送数据端（以下简称请求方）**发送连接请求**，
	- 接受数据端（以下简称接受方）接受连接后**回复ACK报文**，说明已经准备好接受数据了，
	- 请求方收到ack后向接受方**再次发送ACK报文**说明好的我知道你准备好了。那么这样就建立起连接了

- 四次挥手 
	- 当请求方数据发送完后，确定要关闭连接时，向接受方**发送FIN报文**，
	- 接收方获取到FIN后如果发现还有一部分数据没有传输，则会**回应一个ack**给请求方表示你的ack我收到了，但是请等待我的消息，
	- 这时候请求方进入FIN_wAIT状态，当接受方确定数据发送完后，就会**发送FIN报文**，
	- 请求方收到后就知道接收方已经准备好关闭连接了，**再次发送ACK消息**，进入TIME_WAIT(如果发送失败则重传)，接收方收到ACK后就断开连接，而请求方等待一段时间后，没有收到回复，那么请求方就关闭连接,



**sliding window**

对于发送方来说，滑窗的左侧为已发送并已ACK过的片段序列，滑窗右侧是尚未发送的片段序列。滑窗中的片段(比如片段5，6，7)被发送出去，并等待相应的ACK。如果收到片段5的ACK，滑窗将向右移动。这样，新的片段从右侧进入滑窗内，被发送出去，并进入等待状态。在接收到片段5的ACK之前，滑窗不会移动，即使已经收到了片段6和7的ACK。这样，就保证了滑窗左侧的序列是已经发送的、接收到ACK的、符合顺序的片段序列

### 应用层

将字节流数据通过HTTP,FTP,SMTP等协议转换为能够识别的格式，json,xml等。

应用层工作就是定义数据并按照对应**格式进行解析**
 