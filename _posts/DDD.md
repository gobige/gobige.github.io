领域可以进一步划分为子领域。我们把划分出来的多个子领域称为子域，每个子域对应一个更小的问题域或更小的业务范围。

领域建模和微服务建设的过程和方法基本类似，其核心思想就是将问题域逐步分解，降低业务理解和系统实现的复杂度

域可以根据自身重要性和功能属性划分为三类子域，它们分别是：核心域、通用域和支撑域。

DDD提倡从领域模型设计出发，而不是先设计数据模型

领域模型内的实体和值对象就好比个体，而能让实体和值对象协同工作的组织就是聚合，它用来确保这些领域对象在实现共同的业务逻辑时，能保证数据的一致性。

聚合在DDD分层架构里属于领域层，领域层包含了多个聚合，共同实现核心业务逻辑。聚合内实体以充血模型实现个体业务能力，以及业务逻辑的高内聚

如果把聚合比作组织，那聚合根就是这个组织的负责人。聚合根也称为根实体，它不仅是实体，还是聚合的管理者。

**聚合的一些设计原则**

- 在一致性边界内建模真正的不变条件
- 设计小聚合
- 通过唯一标识引用其它聚合
- 在边界之外使用最终一致性
- 通过应用层实现跨聚合的服务调用


DDD四层结构

用户接口层：应用层，领域层，基础层

**微服务架构的演进**

可以以聚合为基础单元，完成领域模型和微服务架构的演进。聚合可以作为一个整体，在不同的领域模型之间重组或者拆分，或者直接将一个聚合独立为微服务

**微服务内服务的演进**
在微服务内部，实体的方法被领域服务组合和封装，领域服务又被应用服务组合和封装

**三层结构和DDD结构区别**

![](https://yatesblog.oss-cn-shenzhen.aliyuncs.com/img/ddd/1.jpg)

## 常见DDD架构

**整洁架构**

整洁架构最主要的原则是依赖原则，它定义了各层的依赖关系，越往里依赖越低，代码级别越高，越是核心能力

![](https://yatesblog.oss-cn-shenzhen.aliyuncs.com/img/ddd/2.jpg)

- 领域模型的主体是实体，一个实体可以是一个带方法的对象，也可以是一个数据结构和方法集合。
- 领域服务实现涉及多个实体的复杂业务逻辑。
- 应用服务实现与用户操作相关的服务组合与编排，它包含了应用特有的业务流程规则，封装和实现了系统所有用例。
- 最外层主要提供适配的能力，适配能力分为主动适配和被动适配。
	- 主动适配主要实现外部用户、网页、批处理和自动化测试等对内层业务逻辑访问适配。
	- 被动适配主要是实现核心业务逻辑对基础资源访问的适配，比如数据库、缓存、文件系统和消息中间件等。红圈内的领域模型、领域服务和应用服务一起组成软件核心业务能力。
	
**六边形架构**

应用是通过端口与外部进行交互的

![](https://yatesblog.oss-cn-shenzhen.aliyuncs.com/img/ddd/3.jpg)

- 红圈内的六边形实现应用的核心业务逻辑；
- 外六边形完成外部应用、驱动和基础资源等的交互和访问，对前端应用以 API 主动适配的方式提供服务，对基础资源以依赖倒置被动适配的方式实现资源访问。


中台本质上是领域的子域，它可能是核心域，也可能是通用域或支撑域。通常大家认为阿里的中台对应 DDD 的通用域，将通用的公共能力沉淀为中台，对外提供通用共享服务。


BFF 微服务与其它微服务存在较大的差异，就是它没有领域模型，因此这个微服务内也不会有领域层。BFF 微服务可以承担应用层和用户接口层的主要职能，完成各个中台微服务的服务组合和编排，可以适配不同前端和渠道的要求


![](https://yatesblog.oss-cn-shenzhen.aliyuncs.com/img/ddd/4.jpg)

**中台的关键词：共享、联通、融合和创新**，快速响应能力和**企业级**的无缝联通和融合能力

阿里业务中台的前身是共享平台，而原来的共享平台更多的被当作资源团队，他们承接各业务方的需求，并为业务方在基础服务上做定制开发。 阿里业务中台的目标是把核心服务链路（会员、商品、交易、营销、店铺、资金结算等）整体当作一个平台产品来做，为前端业务提供的是业务解决方案，而不是彼此独立的系统

业务中台的建设可采用领域驱动设计方法，通过领域建模，将可复用的公共能力从各个单体剥离，沉淀并组合，采用微服务架构模式，建设成为可共享的通用能力中台。