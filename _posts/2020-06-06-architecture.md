---
layout: post
title: '架构之路'
subtitle: '架构之路-理论知识'
date: 2020-06-06
categories: 架构
author: yates
cover: 'http://cctv.com'
tags: 架构
---

## 前言

### **架构发展历史**

- 机器语言对于开发人员来说，**太难写，太难读，太难改**
- 汇编语言需要**精通计算机底层知识**，而且**不同CPU的汇编指令**和结构是不同的	
- 高级语言无法应对**软件规模和复杂化**
- 软件工程，结构化程序 整体上降低软件开发难度，缓解了软件危机。
- 面向对象 缓解了业务变化带来的软件扩展难度

架构历史发展中 没有 放之四海而皆准的银弹

**架构设计的目的是为了解决软件系统复杂度带来的问题 **

## **系统，模块，组件，架构**

**系统**

- 关联：系统由一群有关联个体组成。（如：发动机和轮胎，底盘，而不是和PC）
- 规则：系统个体需按照指定规则运作。而不是个体各自为政
- 能力：系统能力和个体能力有本质差别，系统能力不是个体能力之和，而是产生新能力

**子系统**

由一群关联个体所组成系统，多半是更大系统中一部分

**模块和组件**

从逻辑角度拆分系统，得到单元是“模块”，主要目的是**职责分离**；从物理角度拆分系统后，得到单元是“组件”,主要目的是**单元复用**。

**架构**

指软件系统的顶层结构，架构需要明确系统需要包含哪些个体（子系统，模块，组件）


## **复杂度来源**

### **高性能**

**单机复杂度**

单机高性能软件中，需要考虑多进程，多线程，并发，通信等众多技术点

**集群复杂度**

单机的性能最终有上限的，一个复杂系统运行单机上，所需要关注的性能点很多，相互影响，当性能问题产生时，不好定位，不好作出调整，需要考虑通过集群的**任务分配，任务分解**来达到性能目标。简单的系统更容易做到高性能，单任务也更容易进行扩展

### **高可用**

系统高可用方案五花八门，本质上都是通过“冗余”来实现，通常高可用场景为**计算高可用，存储高可用**，通过**独裁，协商，民主等状态决策方式**得到决策方案。状态决策不可能万无一失，但不做高可用方案又会产生更大问题

### **可扩展**

通过**预测变化和应对变化**的方式在软件开发中缓解可扩展的问题，后者通过系统拆分**变化层和稳定层**，设计变化层和稳定层之间的接口，**抽象和实现**的隔离等方法来应对

### **低成本，安全，规模**

- 低成本本质和高性能和高可用是冲突的，比如服务器资源问题；在很多时候低成本不会是架构设计首要目标，而是架构设计附加约束。我们有一个设计方案，是否满足成本目标，如若不能，则要重新设计，甚至需要创新（引入，自研新技术）。
- 安全，**功能安全**通常更编码有关，往往是在问题出现后进行补救，无法预测下一个漏洞在哪儿，而**架构安全**主要依赖防火墙，同样设计到成本问题
- 规模，功能，数据的增多带来系统复杂度的增长和质变，前者**功能数量和功能之间连接数量**降低整个系统完全可用率；后者需要对数据进行拆分，存储方式上处理


## **架构设计三原则**

### **合适**

**合适优于业界领先**，真正优秀的架构是在企业当前**人力，条件，业务等约束**下设计出来的，能够合理将**资源整合**到一起发挥**最大功效，并快速落地**

### **简单**

复杂在制造领域代表先进，软件领域确代表问题。不管是**结构**还是**逻辑**带来的**复杂性**都无法拥抱**软件的变化本质**

### **演进**

架构设计不可贪大求全，盲目照搬大公司做法，应认真分析当前业务特点，明确面临问题，合理设计，快速落地满足业务需求，运行过程不断完善架构，不断随业务演化架构


## **架构设计流程**

- **识别复杂度**：将主要的复杂度问题列出来，根据业务，技术，团队综合情况进行排序，优先解决当前面临最主要复杂度问题
- **设计备选方案**：架构师需要设计多个备选方案，3~5个最佳；备选方案差异要比较明显；备选方案要不限于已熟悉技术；关注技术选型而不是技术细节
- **评估和选择备选方案**：列出我们需要关注的质量属性点（性能，可用性，硬件成本，项目投入，复杂度，安全性，可扩展性），分别从质量属性维度评估每个方案，再综合挑选适合当时情况最优方案。综合当前业务发展情况，团队人员规模和技能，业务发展预测等优先级进行选择
- **详细方案设计**：将方案涉及的关键技术点确定下来，同时备选方案的技术关键细节有较深入的理解。而不是只是个PPT架构师


## **高性能数据库**

### **读写分离**

通过对数据库服务器搭建集群，一主多从结构。需要注意，主备延迟和分配机制的问题

### **分库分表**

按照业务模块将数据分散到不同数据库服务器，百万，千万用户规模，需要注意，join操作问题，事务问题，成本问题，
亿级用户时，单表的性能无法支撑功能的正常运行，通过垂直和水平切分的手段进行。需要注意，路由问题（范围，Hash，配置路由），join操作，count操作问题，order by问题

### **Nosql**

关系型数据库的有很多不足：

- 只能存储行记录，无法存储数据结构
- schema扩展很不方便
- 大数据统计等场景下，由于需要读出所有记录到内存，所需I/O很高
- 全文搜索功能比较弱

Key-Value结构的Redis，主要缺点不支持完整ACID事务，
文档数据库Mongodb在新增字段简单，历史数据不会出错，很容易存储复杂数据。缺点是不支持事务，无法实现join操作
列式数据库按照列式存储数据，业务同时完成一行中多个列的读取，写操作，需要有特定的使用场景
全文搜索引擎，通过倒排索引的技术，建立单词到文档的索引，达到通过关键词查询文档内容 
