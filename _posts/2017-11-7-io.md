---
layout: post
title: '常见I/O模型'
subtitle: '常见I/O模型'
date: 2017-11-07
categories: 计算机网络
author: yates
cover: 'http://cctv.com'
tags: 计算机网络
---

### 什么是I/O
我们都知道，数据的持久化是发生磁盘的，而能够和硬件打交道的是内核，应用程序想要获得数据就只能通过系统调用获取数据，当进程发生系统调用时，系统进入内核模式，然后开始I/O操作，主要分为两个步骤，1.磁盘把数据装载到内核内存空间 2.内核内存空间拷贝到用户内存空间（I/O发生）

![此处输入图片的描述](http://pev96mxgw.bkt.clouddn.com/img/2018-04-22-computer-system-IO/1.png)

**I/O阻塞**
进程发起I/O调用，内核拷贝数据期间进程会因为等待数据拷贝会挂起，把cpu时间片让出去，此时叫做I/O阻塞，I/O完成，进程会被唤醒。

![此处输入图片的描述](http://pev96mxgw.bkt.clouddn.com/img/2018-04-22-computer-system-IO/2.png)

**非阻塞I/O**
进程发起I/O调用，I/O自己知道需要一段时间才能完成，马上通知进程进行其他操作，叫做非阻塞I/O，在等待期间进程隔一段时间询问是否I/O完成。

![此处输入图片的描述](http://pev96mxgw.bkt.clouddn.com/img/2018-04-22-computer-system-IO/3.png)

**I/O复用**
同时发生多个系统调用，统一使用一个select进行发起调用，内核内存获取到数据后通知调用方，select发起第二阶段的拷贝，进程只会阻塞在第二阶段。

![此处输入图片的描述](http://pev96mxgw.bkt.clouddn.com/img/2018-04-22-computer-system-IO/4.png)


**事件（信号）驱动I/O**
水平触发驱动：内核通知进程读取数据，如果没有读取，不断通知进程
边缘触发驱动：内核只通知一次进程读取数据，进程在超时前可以读取数据

![此处输入图片的描述](http://pev96mxgw.bkt.clouddn.com/img/2018-04-22-computer-system-IO/5.png)


**异步I/O**
进程发起数据请求，内核马上返回信息，进程继续其他操作，内核通知取数据信号，进程处理数据

![此处输入图片的描述](http://pev96mxgw.bkt.clouddn.com/img/2018-04-22-computer-system-IO/6.png)


常见web工作模式
**prefork模式**：
当请求到达时，主进程生成多个工作进程，由工作进程一对一响应请求

**work工作模式**：
当请求到达时，主进程生成多个线程，每个线程去响应客户端请求

**Event工作模式**
当请求到达时，主进程生成多个工作进程，每个进程响应多个客户端请求，当执行I/O操作时，会响应其他请求，等内核通知完成I/O时，重新恢复继续请求处理


**I/O多路复用机制**

- select
- poll
- epoll